= form_tag(tqc_admin_visit_path(@visit, :required_series_name => @required_series.name), :method => :post, :class => 'formtastic form') do
  .panel
    %h3 Automatic DICOM tQC
    .panel_contents
      %table
        %thead
          %tr
            %th DICOM tag
            %th Expected Value
            %th Actual Value
            %th Pass/Fail?
        %tbody
          - @dicom_tqc_spec.each do |spec|
            %tr
              - field_name = 'tqc_result['+spec['id']+']'
              - unless spec['result'].nil?
                = hidden_field_tag(field_name, (spec['result'] == true ? '1' : '0'))
              %td
                = spec['label']
                %span.dicom_tag_key= "(#{spec['dicom_tag']})"
              %td= spec['expected_value']
              %td
                - if spec['actual_value'].nil?
                  %span.status_tag.Missing.error N/A
                - else
                  = spec['actual_value']
              %td
                - case spec['result']
                - when nil
                  = select_tag(field_name, options_for_select([['Fail', '0'], ['Pass', '1']], '0'), :include_blank => false)
                - when true
                  %span.status_tag.Pass.ok Pass
                - else
                  %span.status_tag.Fail.error Fail

  = field_set_tag('<span>tQC Questions</span>'.html_safe, :class => 'inputs') do
    %ol
      - @manual_tqc_spec.each do |spec|
        - field_name = 'tqc_result['+spec['id']+']'
        - current_value = (@required_series.tqc_results.nil? ? nil : @required_series.tqc_results[spec['id']])
        - case spec['type']
        - when 'bool'
          %li.input.select
            = hidden_field_tag(field_name, '0')
            = label_tag(nil, spec['label'])
            = select_tag(field_name, options_for_select([['Fail', '0'], ['Pass', '1']], (current_value ? '1' : '0')), :include_blank => false)
            - unless spec['description'].nil?
              %p.inline-hints= spec['description']

  = field_set_tag(nil, :class => 'actions') do
    %ol
      %li.action.input_action
        = submit_tag('Save tQC Results')
      %li.cancel
        = link_to('Cancel', admin_visit_path(@visit))
