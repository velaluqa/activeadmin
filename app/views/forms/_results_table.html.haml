- placeholders_only = false unless (defined? placeholders_only)
- skip_header = false unless (defined? skip_header)
- display_type = 'results' unless placeholders_only
- roi_links = false unless (defined? roi_links)
- versions = nil unless (defined? versions and not versions.nil? and versions.size == cases.size)
- data_cleaning_buttons = false unless(defined? data_cleaning_buttons and data_cleaning_buttons == true and cases.size == 1)
- do_resolve_randomisation = false unless(defined? do_resolve_randomisation)

- if placeholders_only
  - printable_answers = [form_config]
- else
  - if versions.nil?
    - printable_answers = cases.map {|c| form_answer_for_case(c).printable_answers(do_resolve_randomisation)}
  - else
    - printable_answers = []
    - cases.each_with_index do |c,i|
      - versions[i].each do |version_index|
        - printable_answers << form_answer_for_case(c).printable_answers_for_version(version_index, do_resolve_randomisation)
- current_group_index = nil
- first_in_group = false
- unless printable_answers[0].nil?
  %table.table.table-striped.table-bordered.table-condensed
    - unless (caption.nil? or caption.empty?)
      %caption= caption
    %colgroup
      %col{:style => 'width: 2%'}
      %col{:style => 'width: 23%'}
      - cases.count.times do
        %col{:style => "width: #{((data_cleaning_buttons ? 70.0 : 75.0)/cases.count).floor}%"}
      - if data_cleaning_buttons
        %col{:style => 'width: 5%'}
    - unless skip_header
      %thead
        %tr
          %th{:colspan => 2} Field
          - if placeholders_only
            %th= Answer
          - else
            - cases.each do |c|
              %th= case_for_case(c).images_folder
          - if data_cleaning_buttons
            %th= Clean!
    %tbody
      - printable_answers[0].each_with_index do |field_spec,i|
        - case field_spec['type']
        - when 'include_divider'
          - current_group_index += 1
          - first_in_group = true
        - when 'include_end'
          - current_group_index = nil
          - first_in_group = false
          - if placeholders_only
            %tr{:id => "repeatable_group_end_#{display_type}_#{field_spec['id']}"}
        - when 'include_start'
          - current_group_index = 1
          - first_in_group = true
        - when 'group'
          %tr
            %th{:colspan => 2+cases.count}= field_spec['label'].html_safe
        - when 'section'
        - else
          = render 'forms/results_table_row', :current_group_index => current_group_index, :first_in_group => first_in_group, :field_spec => field_spec, :printable_answers => printable_answers, :cases => cases, :placeholders_only => placeholders_only, :roi_links => roi_links, :data_cleaning_buttons => data_cleaning_buttons
          - first_in_group = false
- else
  = "Failed to render form answers"
