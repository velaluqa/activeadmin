- skip_header = false unless (defined? skip_header)
- roi_links = false unless (defined? roi_links)

- current_group_index = nil
- first_in_group = false
- form_answer_field_maps = {}
- cases.each do |cs|
  - cs.each do |c|
    - next if c.nil?
    - if c.form_answer
      - form_answer_field_maps[c.id] = c.form_answer.form_fields_hash
    - else
      - form_answer_field_maps[c.id] = nil
%table.table.table-striped.table-bordered.table-condensed
  - unless (caption.nil? or caption.empty?)
    %caption= caption
  %colgroup
    %col{:style => 'width: 2%'}
    %col{:style => 'width: 23%'}    
    - cases.count.times do
      %col{:style => "width: #{(75.0/cases.count).floor}%"}
  - unless skip_header
    %thead
      %tr
        %th{:colspan => 2} Field
        - cases.each do |c|
          - if c.blank?
            %th
          - else
            %th= c.first.images_folder
  %tbody
    - table_config.each_with_index do |row_spec,i|
      - if row_spec['group']
        %tr
          %th{:colspan => 2+cases.count}= row_spec['group']
      - elsif row_spec['row']
        = render 'forms/adjudication_custom_results_table_row', :row_spec => row_spec, :columns => cases, :roi_links => roi_links, :form_answer_field_maps => form_answer_field_maps
      - elsif row_spec['repeatable']
        - prefixes = row_spec['repeatable']['prefixes']
        - rows = row_spec['repeatable']['rows']
        - repeatable_size = cases.map{|cs| cs.map{|c| if (c.form_answer and c.form_answer.answers) then c.form_answer.answers[prefixes[c.case_type]].nil? ? 0 : (c.form_answer.answers[prefixes[c.case_type]].size || 0) else 0 end}.max }.max
        - repeatable_size ||= 0
        - repeatable_size.times do |repeatable_index|
          - row_spec['repeatable']['rows'].each_with_index do |repeatable_row_spec, repeatable_row_index|
            = render 'forms/adjudication_custom_results_table_row', :row_spec => repeatable_row_spec, :columns => cases, :roi_links => roi_links, :repeatable => {:index => repeatable_index, :first_row => (repeatable_row_index == 0), :prefixes => prefixes}, :form_answer_field_maps => form_answer_field_maps
